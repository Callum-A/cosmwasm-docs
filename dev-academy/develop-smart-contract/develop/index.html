<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="CosmWasm Documentation" href="/opensearch.xml"><title data-react-helmet="true">Develop Contract | CosmWasm Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.cosmwasm.com/dev-academy/develop-smart-contract/develop"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-dev-academy-current"><meta data-react-helmet="true" property="og:title" content="Develop Contract | CosmWasm Documentation"><meta data-react-helmet="true" name="description" content="In this session, we will build on top of the template we generated on the previous page."><meta data-react-helmet="true" property="og:description" content="In this session, we will build on top of the template we generated on the previous page."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg"><link data-react-helmet="true" rel="canonical" href="https://docs.cosmwasm.com/dev-academy/develop-smart-contract/develop"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/dev-academy/develop-smart-contract/develop" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/fr/dev-academy/develop-smart-contract/develop" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/dev-academy/develop-smart-contract/develop" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.f19334b4.css">
<link rel="preload" href="/assets/js/runtime~main.6e1979ed.js" as="script">
<link rel="preload" href="/assets/js/main.eaf7b60b.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.svg" alt="CosmWasm" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.svg" alt="CosmWasm" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link" href="/docs/1.0/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/dev-academy/intro">Dev Academy</a></li><li><a class="dropdown__link" href="/tutorials/hijack-escrow/intro">Tutorials</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">dApps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cw-plus/0.9.0/overview">cw-plus</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" docspluginid="ecosystem">Ecosystem</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/ecosystem/overview">Overview</a></li><li><a class="dropdown__link" href="/ecosystem/jobs">Jobs</a></li><li><a class="dropdown__link" href="/ecosystem/testnets/build-requirements">Testnets</a></li><li><a class="dropdown__link" href="/ecosystem/hall-of-fame">Hall of Fame</a></li><li><a class="dropdown__link" href="/ecosystem/media/assets">Media</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/dev-academy/develop-smart-contract/develop" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/fr/dev-academy/develop-smart-contract/develop" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">franÃ§ais</a></li></ul></div><div class="toggle_iYfV toggle_2i4l toggleChecked_a04y toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" checked="" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_hmkv"><img src="/img/logo.svg" alt="CosmWasm" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.svg" alt="CosmWasm" class="themedImage_TMUO themedImage--dark_uzRr"></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev-academy/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Basics</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Smart Contract Interaction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Capture the Flag Riddlethon</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Develop Smart Contract</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-academy/develop-smart-contract/intro">Anatomy of a Smart Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dev-academy/develop-smart-contract/develop">Develop Contract</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">DAO And Governance</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Develop Contract</h1></header><p>In this session, we will build on top of the template we generated on the previous <a href="/dev-academy/develop-smart-contract/intro">page</a>.</p><p>Here is the application logic we want:</p><ul><li>Collected tokens in smart contract&#x27;s balance are released to a target address after
the token amount exceeds a specified amount.</li><li>Contract accepts cw20 token that is predefined by the admin.</li></ul><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>We recommend deleting boilerplate code during implementation to help with copying and pasting code.</p></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>You can find the full version of this contract at <a href="https://github.com/InterWasm/cw-contracts/tree/main/contracts" target="_blank" rel="noopener noreferrer">cw-contracts/cw20-pot</a></p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="config">Config<a aria-hidden="true" class="hash-link" href="#config" title="Direct link to heading">â€‹</a></h2><p><code>admin</code> information which determines who has pot creation address must be persisted on contract
storage during each execution. We will save this information to the storage on <code>Instantiate</code> phase.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// state.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Config {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub admin: Addr,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub cw20_addr: Addr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub const CONFIG: Item&lt;Config&gt; = Item::new(&quot;config&quot;);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>Item</code> is used since this data will be a singleton.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="instantiate">Instantiate<a aria-hidden="true" class="hash-link" href="#instantiate" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="msg">Msg<a aria-hidden="true" class="hash-link" href="#msg" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// msg.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct InstantiateMsg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub admin: Option&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// cw20_addr is the address of the allowed cw20 token</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub cw20_addr: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>admin</code> is defined as <code>Option</code> because if <code>None</code>, <code>info.sender</code> will be set as admin.
The accepted cw20 address is set here.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="instantiate-1">Instantiate<a aria-hidden="true" class="hash-link" href="#instantiate-1" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//contract.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn instantiate(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    _env: Env,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    info: MessageInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    msg: InstantiateMsg,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    set_contract_version(deps.storage, CONTRACT_NAME, CONTRACT_VERSION)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let owner = msg.admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .and_then(|s| deps.api.addr_validate(s.as_str()).ok())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .unwrap_or(info.sender);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let config = Config {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        owner: owner.clone(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let config = Config {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        owner: owner.clone(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cw20_addr: deps.api.addr_validate(msg.cw20_addr.as_str())?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CONFIG.save(deps.storage, &amp;config);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // init pot sequence</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    POT_SEQ.save(deps.storage, &amp;Uint128::new(0))?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(Response::new()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;method&quot;, &quot;instantiate&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;owner&quot;, owner)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;cw20_addr&quot;, msg.cw20_addr))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The logic above is for if the owner is <code>Some</code> validate, if not use <code>info.sender</code> and store configuration,
then return <code>Response</code> with attributes.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let owner = msg.admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .and_then(|s| deps.api.addr_validate(s.as_str()).ok())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .unwrap_or(info.sender);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The example above is a great one to understand method chaining.
Great read: <a href="https://doc.rust-lang.org/rust-by-example/error/option_unwrap/and_then.html" target="_blank" rel="noopener noreferrer">Rust Combinator</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="tests">Tests<a aria-hidden="true" class="hash-link" href="#tests" title="Direct link to heading">â€‹</a></h3><p>I leave this part to you as a challenge ;)</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="create-pot">Create Pot<a aria-hidden="true" class="hash-link" href="#create-pot" title="Direct link to heading">â€‹</a></h2><p><code>admin</code> can create pots to collect money in with a given threshold.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="state">State<a aria-hidden="true" class="hash-link" href="#state" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// state.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Pot {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /// target_addr is the address that will receive the pot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub target_addr: Addr,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /// threshold_amount is the token threshold amount</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub threshold_amount: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /// collected keeps information on how much is collected for this pot.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pub collected: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// POT_SEQ holds the last pot ID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub const POT_SEQ: Item&lt;Uint128&gt; = Item::new(&quot;pot_seq&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// POTS are indexed my an auto incremented integer number.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub const POTS: Map&lt;U128Key, Pot&gt; = Map::new(&quot;pot&quot;);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can use a <code>save_pot</code> helper to auto-increment seq and use it as an index for pot.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// state.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn save_pot(deps: DepsMut, pot: &amp;Pot) -&gt; StdResult&lt;()&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // increment id if exists, or return 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let id = POT_SEQ.load(deps.storage)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // checks for overflow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let id = id.checked_add(Uint128::new(1))?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  POT_SEQ.save(deps.storage, &amp;id)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // save pot with id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  POTS.save(deps.storage, id.u128().into(), pot)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="msg-1">Msg<a aria-hidden="true" class="hash-link" href="#msg-1" title="Direct link to heading">â€‹</a></h3><p><code>ExecuteMsg</code> becomes this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// msg.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[serde(rename_all = &quot;snake_case&quot;)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum ExecuteMsg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CreatePot {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// target_addr will receive tokens when token amount threshold is met.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        target_addr: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// threshold is the token amount for releasing tokens.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        threshold: Uint128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="execute">Execute<a aria-hidden="true" class="hash-link" href="#execute" title="Direct link to heading">â€‹</a></h3><p>Depending on the message that is recieved <code>Execute</code> will either <code>CreatePot</code> or <code>Recieve</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// contract.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg_attr(not(feature = &quot;library&quot;), entry_point)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn execute(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    _env: Env,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    info: MessageInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    msg: ExecuteMsg,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    match msg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ExecuteMsg::CreatePot {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            target_addr,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            threshold,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } =&gt; execute_create_pot(deps, info, target_addr, threshold),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ExecuteMsg::Receive(msg) =&gt; execute_receive(deps, info, msg),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The example above is a great one to understand the <a href="https://doc.rust-lang.org/rust-by-example/flow_control/match.html" target="_blank" rel="noopener noreferrer">match</a> operator.
Now that we have added additional options to <code>ExecuteMsg</code> we will go back and update the enum.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//msg.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[serde(rename_all = &quot;snake_case&quot;)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum ExecuteMsg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CreatePot {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// target_addr will receive tokens when token amount threshold is met.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        target_addr: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// threshold is the token amount for releasing tokens.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        threshold: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Receive forwards received cw20 tokens to an execution logic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Receive(Cw20ReceiveMsg),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now that we have updated <code>ExecuteMsg</code>, we must create <code>execute_create_pot</code> which is called by the contract&#x27;s <code>Execute</code> function.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// contract.rs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn execute_create_pot(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    info: MessageInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    target_addr: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    threshold: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // owner authentication</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let config = CONFIG.load(deps.storage)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if config.owner != info.sender {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return Err(ContractError::Unauthorized {});</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // create and save pot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let pot = Pot {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        target_addr: deps.api.addr_validate(target_addr.as_str())?,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        threshold,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        collected: Uint128::zero(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    save_pot(deps, &amp;pot)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(Response::new()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;action&quot;, &quot;execute_create_pot&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;target_addr&quot;, target_addr)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;threshold_amount&quot;, threshold))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="collect-tokens">Collect Tokens<a aria-hidden="true" class="hash-link" href="#collect-tokens" title="Direct link to heading">â€‹</a></h2><p>This is the important part that this document tries to teach: Interaction with an external contract.
The smart contract will collect cw20 tokens. After cw20 token is sent, this contract will operate on this information.</p><p>But how?</p><p>CosmWasm smart contracts work as message-sending actors. Each contract execute other via sending a message
back to the context.</p><p>Users can transfer tokens from their account to the smart contract, then execute the smart contract to save this token
allocation in the next TX. But the problem here is how to verify this token is sent from this user?</p><p>One way to achieve this:</p><ol><li>User <a href="https://github.com/CosmWasm/cw-plus/tree/main/packages/cw20#allowances" target="_blank" rel="noopener noreferrer">increases token allowance</a> of the cw20-pot smart contract address.</li><li>User triggers cw20-pot contract to withdraw allowed funds to its account.</li></ol><p>This operation requires two transactions.</p><p>There is a better and elegant way: <a href="https://github.com/CosmWasm/cw-plus/tree/main/packages/cw20#receiver" target="_blank" rel="noopener noreferrer">cw20 Receiver Interface</a>.</p><p>Works like this, the user creates a message for sending cw20 tokens to cw20-pot contract with an embedded message inside
to trigger cw20-pot execution.</p><p>If you check <a href="https://github.com/CosmWasm/cw-plus/blob/main/contracts/cw20-base/src/contract.rs#L318" target="_blank" rel="noopener noreferrer">cw20-base/contracts.rs#execute_send</a></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn execute_send(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _env: Env,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  contract: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  amount: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  msg: Binary,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the signature, you will notice <code>contract</code>, <code>amount</code> and <code>msg</code>. <code>contract</code> is the recipient of the token and also
address of the next execution, <code>amount</code> is the number of tokens and <code>msg</code> is <code>base64</code> external message.</p><p>At the end of <code>execute_send</code>, you will see a <code>Response</code> with an embedded message sent back to the chain.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let res = Response::new()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;action&quot;, &quot;send&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;from&quot;, &amp;info.sender)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;to&quot;, &amp;contract)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;amount&quot;, amount)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_message(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Cw20ReceiveMsg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                sender: info.sender.into(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                amount,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                msg,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .into_cosmos_msg(contract)?,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(res)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As you can see <code>msg</code> is wrapped in a <code>Cw20ReceiveMsg</code> and for contract-cw20 interaction, your contract accept
<code>Cw20ReceiveMsg</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn execute_receive(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  deps: DepsMut,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  info: MessageInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  wrapped: Cw20ReceiveMsg,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // cw20 address authentication</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let config = CONFIG.load(deps.storage)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if config.cw20_addr != info.sender {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return Err(ContractError::Unauthorized {});</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let msg: ReceiveMsg = from_binary(&amp;wrapped.msg)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  match msg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ReceiveMsg::Send { id } =&gt; receive_send(deps, id, wrapped.amount, info.sender),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>On this line, contract-defined embed receive msg is parsed from base64 binary.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let msg: ReceiveMsg = from_binary(&amp;wrapped.msg)?;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here is the <code>ReceiveMsg</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[serde(rename_all = &quot;snake_case&quot;)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum ReceiveMsg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Send sends token to an id with defined pot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Send { id: Uint128 },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It creates a second depth branch inside <code>execute</code>.</p><p>And the smart contract runs this logic:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn receive_send(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    deps: DepsMut,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pot_id: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    amount: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cw20_addr: Addr,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;Response, ContractError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // load pot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let mut pot = POTS.load(deps.storage, pot_id.u128().into())?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pot.collected += amount;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    POTS.save(deps.storage, pot_id.u128().into(), &amp;pot)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let mut res = Response::new()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;action&quot;, &quot;receive_send&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;pot_id&quot;, pot_id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;collected&quot;, pot.collected)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .add_attribute(&quot;threshold&quot;, pot.threshold);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // if collected exceeds threshold prepare a cw20 message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if pot.collected &gt;= pot.threshold {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Cw20Contract is a function helper that provides several queries and message builder.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let cw20 = Cw20Contract(cw20_addr);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Build a cw20 transfer send msg, that send collected funds to target address</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let msg = cw20.call(Cw20ExecuteMsg::Transfer {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            recipient: pot.target_addr.into_string(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            amount: pot.collected,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        })?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        res = res.add_message(msg);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(res)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After the execution, if the threshold is passed, the collected amount is sent to the target.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="summary">Summary<a aria-hidden="true" class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p>In this section, we showed you contract to contract interaction and cw20 contract interaction.
This should give you some insight to message passing, Actor model, and contract development.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="challenge">Challenge<a aria-hidden="true" class="hash-link" href="#challenge" title="Direct link to heading">â€‹</a></h2><p>As a challenge, you can try to implement a contract that extends <a href="https://github.com/CosmWasm/cosmwasm-plus/" target="_blank" rel="noopener noreferrer">cw-plus</a>
or <a href="https://github.com/CosmWasm/cw-nfts" target="_blank" rel="noopener noreferrer">cw-nfts</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/InterWasm/docs/edit/main/dev-academy/develop-smart-contract/02-develop.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dev-academy/develop-smart-contract/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Anatomy of a Smart Contract</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dev-academy/dao-governance/what-is-smart-contracts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Introduction<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#config" class="table-of-contents__link toc-highlight">Config</a></li><li><a href="#instantiate" class="table-of-contents__link toc-highlight">Instantiate</a><ul><li><a href="#msg" class="table-of-contents__link toc-highlight">Msg</a></li><li><a href="#instantiate-1" class="table-of-contents__link toc-highlight">Instantiate</a></li><li><a href="#tests" class="table-of-contents__link toc-highlight">Tests</a></li></ul></li><li><a href="#create-pot" class="table-of-contents__link toc-highlight">Create Pot</a><ul><li><a href="#state" class="table-of-contents__link toc-highlight">State</a></li><li><a href="#msg-1" class="table-of-contents__link toc-highlight">Msg</a></li><li><a href="#execute" class="table-of-contents__link toc-highlight">Execute</a></li></ul></li><li><a href="#collect-tokens" class="table-of-contents__link toc-highlight">Collect Tokens</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#challenge" class="table-of-contents__link toc-highlight">Challenge</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Related Documentation</div><ul class="footer__items"><li class="footer__item"><a href="https://cosmos.network/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cosmos SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://hub.cosmos.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cosmos Hub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.tendermint.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Tendermint Core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Repositories</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cosmwasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/wasmd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/wasmd<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cw-plus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CosmWasm/cw-plus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm/cw-contracts" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm/cw-contracts<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm/cw-awesome" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm/cw-awesome<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.cosmwasm.com/chat/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/CosmWasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/InterWasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>InterWasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://cosmwasm.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 CosmWasm</div></div></div></footer></div>
<script src="/assets/js/runtime~main.6e1979ed.js"></script>
<script src="/assets/js/main.eaf7b60b.js"></script>
</body>
</html>